---
title: "easyclimate: Analysing the climate of a given period introducing coordinates as a polygon"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteEncoding{UTF-8}
  %\VignetteIndexEntry{easyclimate: Analysing the climate of a given period introducing coordinates as a polygon}
  %\VignetteEngine{knitr::rmarkdown}
---

```{r setup, echo = FALSE}
knitr::opts_chunk$set(eval = TRUE, collapse = TRUE, warning = FALSE, message = FALSE, fig.width = 6, fig.height = 4)
```

`easyclimate` aims to easily download daily climate data and calculate multiple climatic indices for a given set of points or polygons within Europe.

# Installation

You can download and install the latest version of `easyclimate` from github:

```{r, eval = FALSE}
remotes::install_github("VeruGHub/easyclimate")
```

# Example: Introducing coordinates as a polygon

You only have to specify the four corners of the polygon from which you want to download the climatic data. You can also specify the type of output you want to obtain.

```{r}

library(easyclimate)
library(tidyverse)
library(viridis)
library(rworldmap)
library(terra)

coords_t <- terra::vect("POLYGON ((-4.5 41, -4.5 40.5, -5 40.5, -5 41))")

Sys.time() # to know how much it takes to download

ex_df_tmax <- get_daily_climate(
  coords_t,
  period = c("2012-01-01", "2012-08-01"),
  climatic_var = "Tmax",
  output = "df" # return dataframe
  )

Sys.time()

```

Note that temperature and precipitation units are ºC\*100 and mm\*100 to avoid floating values. You can mutate them, include the all the variables you might be interested in.

```{r}

glimpse(ex_df_tmax)

clim_df <- ex_df_tmax %>%
  mutate(
    tmax = Tmax / 100,
    date = as.Date(date),
    month = months(date),
    year = format(date, format = "%y")
    ) %>%
  relocate(
    x, y, date, year, month, tmax
    )

```

Then, you can visualise the results by comparing both dates

```{r}

world <- getMap(resolution = "low") 

countries <- world[world@data$ADMIN %in% c("Spain", "Portugal", "France"), ]

ggplot() +
	geom_polygon(data = countries, 
		aes(x = long, y = lat, group = group),
		fill = NA, colour = "black") + 
	geom_point(data = clim_df,
		aes(x = x, y = y, color = tmax)) +
  coord_fixed(xlim = c(-10, 0), ylim = c(36, 44), ratio = 1.3) + 
  scale_color_viridis_c(option = "magma") +
  facet_wrap(~month) +
	xlab("Longitude") +
	ylab("Latitude") +
  theme(
    panel.grid.major = element_line(colour = "grey90", size = 0.5),
    axis.line = element_blank(),
    panel.background = element_blank()
  )

```

You can do the same but using raster as output

```{r}

Sys.time()

ex_ras_tmax <- get_daily_climate(
  coords_t,
  period = c("2012-01-01", "2012-08-01"),
  climatic_var = "Tmax",
  output = "raster" # return raster
  )

Sys.time()

plot(ex_ras_tmax, col = rev(heat.colors(7))) # temperature units are ºC\*100

```

# Learn more

`easyclimate` can handle different types of input and output objects or download data from multiple locations and periods. Check out the vignettes with more information on the other options in this package here:
