---
title: "easyclimate: Analysing the climate of an area for a given period"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteEncoding{UTF-8}
  %\VignetteIndexEntry{easyclimate: Analysing the climate of an area for a given period}
  %\VignetteEngine{knitr::rmarkdown}
---

```{r setup, echo = FALSE}
knitr::opts_chunk$set(eval = TRUE, collapse = TRUE, warning = FALSE, message = FALSE, fig.width = 6, fig.height = 4)
```

`easyclimate` aims to easily download daily climate data for a given set of points or polygons within Europe. You can download and install the latest version of `easyclimate` from github: https://github.com/VeruGHub/easyclimate 

In this tutorial we will work through the basics of using easyclimate with a spatial polygon.

If you wish to download the climatic data of a specific region, you need to specify at least four corners of the polygon including the area and specify the type of output you want to obtain (i.e. a dataframe - "df" or a raster - "raster").

```{r}
library(easyclimate)
library(terra)

coords_t <- vect("POLYGON ((-4.5 41, -4.5 40.5, -5 40.5, -5 41))")

Sys.time() # to know how much it takes to download

ex_df_tmax <- get_daily_climate(
  coords_t,
  period = c("2012-01-01", "2012-08-01"),
  climatic_var = "Tmax",
  output = "df" # return dataframe
  )

Sys.time()

```

Note that temperature is given as ºC\*100 to avoid floating values. You can mutate this variable as follows:

```{r}
library(dplyr)

clim_df <- ex_df_tmax %>%
  mutate(
    tmax = Tmax / 100,
    date = as.Date(date)
    ) 

```

Then, you can visualize the results and compare both dates

```{r}

library(ggplot2)

tapply(clim_df$tmax, clim_df$date, summary)

ggplot() +
	geom_raster(data = clim_df,
		aes(x = x, y = y, fill = tmax)) +
  scale_fill_continuous(type = "viridis", name = "Maximum\ntemperature (ºC)") +
  facet_wrap(~date) +
	ylab("Latitude") + xlab("Longitude") +
  theme_bw()

```

You can do the same but using raster as output

```{r}

Sys.time()

ex_ras_tmax <- get_daily_climate(
  coords_t,
  period = c("2012-01-01", "2012-08-01"),
  climatic_var = "Tmax",
  output = "raster" # return raster
  )

Sys.time()

ex_ras_tmax <- ex_ras_tmax/100
  
plot(ex_ras_tmax, col = rev(heat.colors(7))) 

```

# Learn more

Now you know how to extract climatic variables with `easyclimate`, for a specific area. Check out this [other vignette](/vignettes/ex1-vignette-df-m-sf.Rmd) it you need to extract the data for specific points.
